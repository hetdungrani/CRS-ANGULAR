name: Deploy Frontend to GitHub Pages

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm install

      - name: Build Client
        run: npx ng build client --configuration production --base-href /CRS-ANGULAR/client/

      - name: Build Admin
        run: npx ng build admin --configuration production --base-href /CRS-ANGULAR/admin/

      - name: Prepare Deployment Folder
        run: |
          mkdir -p public/client
          mkdir -p public/admin
          cp -r dist/client/browser/* public/client/
          cp -r dist/admin/browser/* public/admin/
          # Create a simple landing page
          echo '<!DOCTYPE html><html><head><title>CRS Project</title><style>body{font-family:sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background:#f0f2f5} .card{background:white;padding:2rem;border-radius:12px;box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);text-align:center} a{display:block;margin:1rem;padding:1rem;background:#0056b3;color:white;text-decoration:none;border-radius:6px;font-weight:bold} a:hover{background:#004494}</style></head><body><div class="card"><h1>CRS Project</h1><a href="/CRS-ANGULAR/client/">Go to Student Portal</a><a href="/CRS-ANGULAR/admin/">Go to Admin Dashboard</a></div></body></html>' > public/index.html
          # SPA support
          cp public/client/index.html public/client/404.html
          cp public/admin/index.html public/admin/404.html

      - name: Deploy to GitHub Actions
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./public
